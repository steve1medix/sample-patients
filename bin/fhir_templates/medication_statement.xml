{%- extends "entry.xml" %}
{%- block content %}
<MedicationStatement>
    {{resource_id}}
    <text>
        <status value="generated"/>
        <div xmlns="http://www.w3.org/1999/xhtml">{{m.name}} (rxnorm: {{m.rxn}})</div>
    </text>
    <patient>
        <reference value="{{base_url}}{{pid}}"/>
    </patient>
    <status value="{{m.status}}"/>
    <medicationCodeableConcept>
        <coding>
            <system value="http://www.nlm.nih.gov/research/umls/rxnorm"/>
            <code value="{{m.rxn}}"/>
            <display value="{{m.name}}"/>
        </coding>
        <text value="{{m.name}}"/>
    </medicationCodeableConcept>
    <dosage>
        <text value="{{m.sig}}"/>
        {%- if m.freqduration %}
        <timing>
            <repeat>
                <boundsPeriod>
                    <start value="{{m.start}}"/>
                    {%- if m.end is defined and m.end != "" %}
                    <end value="{{m.end}}"/>
                    {% endif %}
                </boundsPeriod>
                <frequency value="{{m.freq}}"/>
                <period value="1"/>
                <periodUnits value="{{m.freqduration}}"/>
            </repeat>
        </timing>
        {% endif %}
        {%- if "prn" in m.sig %}
        <asNeededBoolean value="true"/>
        {% endif %}
        {%- if m.qtt %}
        <quantityQuantity>
            <value value="{{m.qtt}}"/>
            <unit value="{{m.qttunit}}"/>
            <system value="http://unitsofmeasure.org"/>
            <code value="{{m.qttunit}}"/>
        </quantityQuantity>
        {% endif %}
    </dosage>
</MedicationStatement>
{% endblock %}

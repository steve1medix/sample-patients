{%- extends "entry.xml" %}
{%- block content %}
<Observation>
    {{resource_id}}
    <text>
        <status value="generated"/>
        <div xmlns="http://www.w3.org/1999/xhtml">{{o.date}}: {{o.name}} = {{o.value}} {{o.units|default('')}}</div>
    </text>
    <status value="final"/>
    <category>
        <coding>
            <system value="http://hl7.org/fhir/observation-category"/>
            <code value="vital-signs"/>
            <display value="Vital Signs"/>
        </coding>
        <text value="Vital Signs"/>
    </category>
    <code>
        <coding>
            <system value="http://loinc.org"/>
            <code value="{{o.code}}"/>
            <display value="{{o.name}}"/>
        </coding>
        <text value="{{o.name}}"/>
    </code>
    <subject>
        <reference value="{{base_url}}{{pid}}"/>
    </subject>
    {%- if o.encounter_id %}
    <encounter>
        <reference value="{{base_url}}{{o.encounter_id}}"/>
    </encounter>
    {% endif %}
    <effectiveDateTime value="{{o.date}}"/>
    {%- if o.scale is defined and o.scale == 'Qn' %}
    <valueQuantity>
        <value value="{{o.value | float(0)}}"/>
        <unit value="{{o.units}}"/>
        <system value="http://unitsofmeasure.org"/>
        <code value="{{o.unitsCode}}"/>
    </valueQuantity>
    {% endif %}
    {%- if o.scale is defined and (o.scale == 'Ord' or o.scale == 'Nom')%}
    <valueString value="{{o.value}}"/>
    {% endif %}
</Observation>
{% endblock %}
